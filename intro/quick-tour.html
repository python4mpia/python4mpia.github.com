

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Quick tour of Python &mdash;  0.1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title=" 0.1.0 documentation" href="../index.html" />
    <link rel="up" title="Introduction and Motivation" href="intro.html" />
    <link rel="next" title="Who is using Python" href="who-python.html" />
    <link rel="prev" title="Why use Python?" href="why-python.html" />
 
<script type="text/javascript"> 
$(document).ready(function(){

$(".flip0").click(function(){
    $(".panel0").slideToggle("normal");
  });

$(".flip1").click(function(){
    $(".panel1").slideToggle("normal");
  });

$(".flip2").click(function(){
    $(".panel2").slideToggle("normal");
  });

$(".flip3").click(function(){
    $(".panel3").slideToggle("normal");
  });

$(".flip4").click(function(){
    $(".panel4").slideToggle("normal");
  });

$(".flip5").click(function(){
    $(".panel5").slideToggle("normal");
  });

$(".flip6").click(function(){
    $(".panel6").slideToggle("normal");
  });

$(".flip7").click(function(){
    $(".panel7").slideToggle("normal");
  });

$(".flip8").click(function(){
    $(".panel8").slideToggle("normal");
  });

$(".flip9").click(function(){
    $(".panel9").slideToggle("normal");
  });

});
</script>
 
<style type="text/css"> 

div.panel0,p.flip0
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip0
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel0
{
display:none;
}

div.panel1,p.flip1
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip1
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel1
{
display:none;
}

div.panel2,p.flip2
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip2
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel2
{
display:none;
}

div.panel3,p.flip3
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip3
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel3
{
display:none;
}

div.panel4,p.flip4
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip4
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel4
{
display:none;
}

div.panel5,p.flip5
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip5
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel5
{
display:none;
}

div.panel6,p.flip6
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip6
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel6
{
display:none;
}

div.panel7,p.flip7
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip7
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel7
{
display:none;
}

div.panel8,p.flip8
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip8
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel8
{
display:none;
}

div.panel9,p.flip9
{
    font-size: 0.9em;
    margin: 0;
    padding: 0.1em 0 0.1em 0.5em;
    border-bottom: 1px solid #86989B;
}
p.flip9
{
    color: white;
    font-weight: bold;
    background-color: #AFC1C4;
}
div.panel9
{
display:none;
}

</style>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-27427631-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="who-python.html" title="Who is using Python"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="why-python.html" title="Why use Python?"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html"> 0.1.0 documentation</a> &raquo;</li>
          <li><a href="intro.html" accesskey="U">Introduction and Motivation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Quick tour of Python</a><ul>
<li><a class="reference internal" href="#making-a-publication-quality-image">Making a publication quality image</a></li>
<li><a class="reference internal" href="#the-basics">The Basics</a></li>
<li><a class="reference internal" href="#array-indexing">Array indexing</a></li>
<li><a class="reference internal" href="#reading-text-files-and-plotting">Reading text files and plotting</a></li>
<li><a class="reference internal" href="#making-a-fancy-plot-from-monte-carlo-samples">Making a fancy plot from Monte-Carlo samples</a></li>
<li><a class="reference internal" href="#parallel-process-of-fits-images">Parallel process of FITS images</a></li>
<li><a class="reference internal" href="#more-examples">More Examples</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="why-python.html"
                        title="previous chapter">Why use Python?</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="who-python.html"
                        title="next chapter">Who is using Python</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/intro/quick-tour.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="quick-tour-of-python">
<span id="quick-tour"></span><h1>Quick tour of Python<a class="headerlink" href="#quick-tour-of-python" title="Permalink to this headline">¶</a></h1>
<p>In the spirit of this workshop let&#8217;s jump in to real Python analysis code.</p>
<div class="section" id="making-a-publication-quality-image">
<h2>Making a publication quality image<a class="headerlink" href="#making-a-publication-quality-image" title="Permalink to this headline">¶</a></h2>
<p>Making a publication quality image is a snap in Python using the <a class="reference external" href="http://aplpy.github.com">APLpy</a> package (the Astronomical Plotting Library in Python).  Images can be made interactively or (reproducibly) with a script. Let&#8217;s use this in combination with <a class="reference external" href="http://atpy.github.com">ATpy</a> (Astronomical Tables in Python) to make a plot of a region with contours and a catalog overlaid.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">aplpy</span>
<span class="kn">import</span> <span class="nn">atpy</span>

<span class="c"># Create a new figure</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">aplpy</span><span class="o">.</span><span class="n">FITSFigure</span><span class="p">(</span><span class="s">&#39;i3.fits&#39;</span><span class="p">)</span>

<span class="c"># Show the colorscale</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show_colorscale</span><span class="p">()</span>

<span class="c"># Add contours</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show_contour</span><span class="p">(</span><span class="s">&#39;sc.fits&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&#39;jet&#39;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c"># Make ticks white</span>
<span class="n">fig</span><span class="o">.</span><span class="n">ticks</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s">&#39;white&#39;</span><span class="p">)</span>

<span class="c"># Make labels smaller and serif</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tick_labels</span><span class="o">.</span><span class="n">set_font</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="s">&#39;small&#39;</span><span class="p">)</span>

<span class="c"># Overlay a grid</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_grid</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c"># Add a colorbar</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_colorbar</span><span class="p">()</span>

<span class="c"># Use ATpy to read in an IRSA table</span>
<span class="n">tab</span> <span class="o">=</span> <span class="n">atpy</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span><span class="s">&#39;2mass.tbl&#39;</span><span class="p">)</span>
<span class="n">tab_bright</span> <span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">tab</span><span class="p">[</span><span class="s">&#39;j_m&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">13.</span><span class="p">)</span>

<span class="c"># Plot markers</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show_markers</span><span class="p">(</span><span class="n">tab</span><span class="p">[</span><span class="s">&#39;ra&#39;</span><span class="p">],</span> <span class="n">tab</span><span class="p">[</span><span class="s">&#39;dec&#39;</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;+&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s">&#39;white&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show_markers</span><span class="p">(</span><span class="n">tab_bright</span><span class="p">[</span><span class="s">&#39;ra&#39;</span><span class="p">],</span> <span class="n">tab_bright</span><span class="p">[</span><span class="s">&#39;dec&#39;</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s">&#39;white&#39;</span><span class="p">)</span>

<span class="c"># Save image for publication</span>
<span class="n">fig</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s">&#39;aplpy_plot.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This produces the nice image:</p>
<a class="reference internal image-reference" href="../_images/aplpy_plot.png"><img alt="../_images/aplpy_plot.png" src="../_images/aplpy_plot.png" style="width: 547.8px; height: 470.4px;" /></a>
<p>We can also easily make 3-color images with FITS files that have different projections:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">aplpy</span>

<span class="c"># Convert all images to common projection</span>
<span class="n">aplpy</span><span class="o">.</span><span class="n">make_rgb_cube</span><span class="p">([</span><span class="s">&#39;m1.fits&#39;</span><span class="p">,</span> <span class="s">&#39;i3.fits&#39;</span><span class="p">,</span> <span class="s">&#39;i2.fits&#39;</span><span class="p">],</span> <span class="s">&#39;rgb.fits&#39;</span><span class="p">)</span>

<span class="c"># Make 3-color image</span>
<span class="n">aplpy</span><span class="o">.</span><span class="n">make_rgb_image</span><span class="p">(</span><span class="s">&#39;rgb.fits&#39;</span><span class="p">,</span> <span class="s">&#39;rgb.png&#39;</span><span class="p">,</span>
                     <span class="n">vmin_r</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">vmax_r</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
                     <span class="n">vmin_g</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax_g</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
                     <span class="n">vmin_b</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span><span class="n">vmax_b</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                     <span class="n">embed_avm_tags</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c"># Make a plot similarly to before</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">aplpy</span><span class="o">.</span><span class="n">FITSFigure</span><span class="p">(</span><span class="s">&#39;rgb.png&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show_rgb</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show_contour</span><span class="p">(</span><span class="s">&#39;sc.fits&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&#39;jet&#39;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">ticks</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s">&#39;white&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tick_labels</span><span class="o">.</span><span class="n">set_font</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="s">&#39;small&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_grid</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s">&#39;aplpy_rgb_plot.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Which produces the following:</p>
<a class="reference internal image-reference" href="../_images/aplpy_rgb_plot.png"><img alt="../_images/aplpy_rgb_plot.png" src="../_images/aplpy_rgb_plot.png" style="width: 512.4px; height: 468.6px;" /></a>
</div>
<div class="section" id="the-basics">
<h2>The Basics<a class="headerlink" href="#the-basics" title="Permalink to this headline">¶</a></h2>
<p>Here is a brief guide to the basics of python syntax.
Defining variables:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">a</span><span class="o">=</span><span class="mi">1</span>
<span class="n">name</span><span class="o">=</span><span class="s">&quot;Jorge&quot;</span>
</pre></div>
</div>
<p>Python figures out the variable type for you.</p>
<p>Define functions</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;John&quot;</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Hello, &quot;</span><span class="o">+</span><span class="n">name</span>

<span class="k">def</span> <span class="nf">list_hello</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;Tom&quot;</span><span class="p">,</span> <span class="s">&quot;Dick&quot;</span><span class="p">,</span> <span class="s">&quot;Harry&quot;</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;Hello, &quot;</span><span class="o">+</span><span class="n">name</span>
</pre></div>
</div>
<p>&#8221;:&#8221; indicates the beginning of something.  Indentation (4 spaces) tells python
which code is included in the code segment instead of <cite>{</cite> and <cite>}</cite>.</p>
<p>Functions in python can take both mandatory arguments and optional
keyword arguments. You can set default arguments for keywords.</p>
<p>It is easy to loop through elements of a <cite>list</cite> using a <cite>for</cite> loop.</p>
<p>Run the functions by inside python typing</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">hello</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">list_hello</span><span class="p">()</span>
</pre></div>
</div>
<p>Run a script file in <cite>ipython</cite> using the <cite>run</cite> command:</p>
<div class="highlight-python"><pre>In [1]: run myfile.py
In [2]: a
Out[2]: 1

In [3]: name
Out[3]: 'Jorge'</pre>
</div>
<p>The variables you define in the script file are still available to you.:</p>
<div class="highlight-python"><pre>In [4]: hello
Out[4]: &lt;function hello at 0x1cec8c0&gt;</pre>
</div>
<p>Whoops.  A function needs to be called with <cite>()</cite>.  Otherwise, python just
tells you that it is a function:</p>
<div class="highlight-python"><pre>In [5]: hello()
Hello, John</pre>
</div>
<p>I can also set the keyword explicitly:</p>
<div class="highlight-python"><pre>In [6]: hello(name="Bryan")
Hello, Bryan</pre>
</div>
<p>or be lazy and just pass in the argument alone and python will assign it to
the keyword in the corresponding position:</p>
<div class="highlight-python"><pre>In [7]: hello("Dieter")
Hello, Dieter</pre>
</div>
<p>My list example also works:</p>
<div class="highlight-python"><pre>In [8]: list_hello()
Hello, Tom
Hello, Dick
Hello, Harry</pre>
</div>
</div>
<div class="section" id="array-indexing">
<h2>Array indexing<a class="headerlink" href="#array-indexing" title="Permalink to this headline">¶</a></h2>
<p>Numpy array indexing and multidimensional arrays:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">random</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">asciitable</span>

<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s">&#39;all&#39;</span><span class="p">)</span>

<span class="c"># Create a simple numerical numpy 1D array (a vector, if you like):</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="k">print</span> <span class="n">x</span>


<span class="c"># To index a single element in x:</span>
<span class="k">print</span> <span class="s">&#39;the first element of x is {0}&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span> <span class="s">&#39;the second element of x is {0}&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c"># Selecting ranges with the :</span>
<span class="k">print</span> <span class="s">&#39;to select the first 4 elements of x type x[0:4] or simply x[:4]= {0}&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>

<span class="c"># Indexing in steps</span>
<span class="k">print</span> <span class="s">&#39;pick every other element of x by typing x[: :2] = {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span> <span class="p">:</span> <span class="mi">2</span><span class="p">])</span>

<span class="c"># Negative indexing: start counting from the end</span>
<span class="k">print</span> <span class="s">&#39;The last element of x can be indexed as x[-1] = {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="k">print</span> <span class="s">&#39;The last-but-one element of x can be indexed as x[-2] = {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>

<span class="c"># Negative indexing can also be used to select ranges, as above:</span>
<span class="k">print</span> <span class="s">&#39;The last 4 elements of x are picked with x[-4:] = {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>
<span class="k">print</span> <span class="s">&#39;Negative indexing and stepsizes can be used to reverse an array! try e.g. x[: :-1] = {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>


<span class="c"># Now let&#39;s create a more typical array, with 2 dimensions, with numpy&#39;s random number generator:</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mf">10.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)))</span>
<span class="k">print</span> <span class="n">x2</span>

<span class="c"># Indexing a 2D array is much the same as for a 1D array.... The : indicates &quot;all elements from this axis&quot;</span>
<span class="k">print</span> <span class="s">&#39;Element (1,1) of x2 is selected by x2[0,0] = {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span> <span class="s">&#39;The first row of x2 is selected by x2[0,:] = {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
<span class="k">print</span> <span class="s">&#39;The 3rd column of x2 is selected by x2[:,2] = {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x2</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>

<span class="c"># We can also create more multi-dimensional arrays. This is a 4D array:</span>
<span class="n">x4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mf">10.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
<span class="k">print</span> <span class="n">x4</span>

<span class="c"># In principle indexing an N-dimensional array is again similar to previous examples....</span>
<span class="k">print</span> <span class="s">&#39;The (0,0,0,0) element of x4 is selected by x4[0,0,0,0] = {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x4</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span> <span class="s">&#39;To select just from one axis and include all elements from the other axes, use ..., e.g. x4[1,...] = </span><span class="se">\n</span><span class="s">{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x4</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="o">...</span><span class="p">])</span>


<span class="c"># Now look at a more complex dataset: a catalogue, which I can read in with the asciitable package.</span>
<span class="c"># this datafile is the 1st data release of large bubbles from the Milky Way Project (http://www.milkywayproject.org/data)</span>
<span class="k">print</span> <span class="s">&#39;Reading in catalogue of bubbles....&#39;</span>
<span class="n">catfile</span> <span class="o">=</span> <span class="s">&#39;mwp-large-bubbles-dr1-25-01-2012.csv&#39;</span>
<span class="n">catcols</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="s">&quot;lat&quot;</span><span class="p">,</span><span class="s">&quot;lon&quot;</span><span class="p">,</span><span class="s">&quot;dl0&quot;</span><span class="p">,</span><span class="s">&quot;reff&quot;</span><span class="p">,</span><span class="s">&quot;abratio&quot;</span><span class="p">,</span><span class="s">&quot;thick&quot;</span><span class="p">,</span><span class="s">&quot;thickoutratio&quot;</span><span class="p">,</span><span class="s">&quot;reffout&quot;</span><span class="p">,</span><span class="s">&quot;ecc&quot;</span><span class="p">,</span><span class="s">&quot;hitrate&quot;</span><span class="p">,</span><span class="s">&quot;disp&quot;</span><span class="p">,</span><span class="s">&quot;hierarchy&quot;</span><span class="p">]</span>
<span class="n">catexc</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;dl0&quot;</span><span class="p">,</span> <span class="s">&quot;abratio&quot;</span><span class="p">,</span> <span class="s">&quot;thick&quot;</span><span class="p">,</span> <span class="s">&quot;thickoutratio&quot;</span><span class="p">,</span> <span class="s">&quot;reffout&quot;</span><span class="p">,</span> <span class="s">&quot;ecc&quot;</span><span class="p">,</span> <span class="s">&quot;hitrate&quot;</span><span class="p">,</span><span class="s">&quot;disp&quot;</span><span class="p">,</span><span class="s">&quot;hierarchy&quot;</span><span class="p">]</span>                 <span class="c">#columns to exclude</span>
<span class="n">cat</span><span class="o">=</span><span class="n">asciitable</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">catfile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">catcols</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s">&#39;#&#39;</span><span class="p">)</span>
<span class="n">neg</span><span class="o">=</span><span class="n">cat</span><span class="o">.</span><span class="n">lon</span> <span class="o">&gt;</span> <span class="mf">180.</span>
<span class="n">cat</span><span class="o">.</span><span class="n">lon</span><span class="p">[</span><span class="n">neg</span><span class="p">]</span><span class="o">=</span><span class="n">cat</span><span class="o">.</span><span class="n">lon</span><span class="p">[</span><span class="n">neg</span><span class="p">]</span><span class="o">-</span><span class="mf">360.</span>
<span class="k">print</span> <span class="s">&#39;# bubbles in catalogue: </span><span class="si">%i</span><span class="s">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">cat</span><span class="p">))</span>

<span class="c"># This reads the catalogue into a numpy recarray</span>

<span class="c"># Plot them on the sky using the scatter function in matplotlib.pyplot (plt.scatter):</span>
<span class="n">scat</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ball</span> <span class="o">=</span> <span class="n">scat</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">311</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">cat</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s">&#39;green&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;all bubbles&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;lon&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s">&#39;best&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;lat&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s">&#39;Bubbles in the inner galactic plane&#39;</span><span class="p">)</span>


<span class="c"># or we can just plot the ones at positive latitudes</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">cat</span><span class="p">[</span><span class="n">cat</span><span class="o">.</span><span class="n">lat</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">]</span>
<span class="n">bpos</span> <span class="o">=</span> <span class="n">scat</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">312</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">pos</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;bubbles, b &gt;= 0.&#39;</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;lon&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s">&#39;best&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;lat&#39;</span><span class="p">)</span>

<span class="c"># or those with effective radii &gt; 5 arcminutes</span>
<span class="n">big</span> <span class="o">=</span> <span class="n">cat</span><span class="p">[</span><span class="n">cat</span><span class="o">.</span><span class="n">reff</span> <span class="o">&gt;=</span> <span class="mf">5.</span><span class="p">]</span>
<span class="n">bbig</span> <span class="o">=</span> <span class="n">scat</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">313</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">big</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">big</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;big bubbles&#39;</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;lon&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s">&#39;best&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;lat&#39;</span><span class="p">)</span>

<span class="c"># show the figure:</span>
<span class="n">scat</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="reading-text-files-and-plotting">
<h2>Reading text files and plotting<a class="headerlink" href="#reading-text-files-and-plotting" title="Permalink to this headline">¶</a></h2>
<p>Plot the space and redshift distribution of luminous red galaxies
(LRGs) from the 2SLAQ survey. The catalogue is available here:
<a class="reference external" href="http://www.2slaq.info/2SLAQ_LRG_v5pub.cat">http://www.2slaq.info/2SLAQ_LRG_v5pub.cat</a>. First we&#8217;ll read the
required columns from this text file and plot the galaxy distribution
in a thin declination slice, showing the galaxy brightness by the
point size, and colouring points by the r-i colour:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">integrate</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>

<span class="c"># To plot the space distribution we need to convert redshift to</span>
<span class="c"># distance.  The values and function below are needed for this</span>
<span class="c"># conversion.</span>
<span class="n">omega_m</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">omega_lam</span> <span class="o">=</span> <span class="mf">0.7</span>
<span class="n">H0</span> <span class="o">=</span> <span class="mf">70.</span>    <span class="c"># Hubble parameter at z=0, km/s/Mpc</span>
<span class="n">c_kms</span> <span class="o">=</span> <span class="mf">299792.458</span> <span class="c"># speed of light, km/s</span>
<span class="n">dH</span> <span class="o">=</span> <span class="n">c_kms</span> <span class="o">/</span> <span class="n">H0</span>          <span class="c"># Hubble distance, Mpc</span>

<span class="k">def</span> <span class="nf">inv_efunc</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Used to calculate the comoving distance to object at redshift</span>
<span class="sd">    z. Eqn 14 from Hogg, astro-ph/9905116.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">omega_m</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">z</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="n">omega_lam</span><span class="p">)</span>

<span class="c"># Now read the LRG positions, magnitudes and redshifts and r-i colours.</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="s">&#39;2SLAQ_LRG_v5pub.cat&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">176</span><span class="p">,</span>
                  <span class="n">names</span><span class="o">=</span><span class="s">&#39;name,z,rmag,RA,Dec,rmi&#39;</span><span class="p">,</span>
                  <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>

<span class="c"># Only keep objects with a redshift larger than 0.1 and in a narrow</span>
<span class="c"># declination slice around the celestial equator</span>
<span class="n">condition</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s">&#39;Dec&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">condition</span><span class="p">]</span>

<span class="c"># Calculate the comoving distance corresponding to each object&#39;s redshift</span>
<span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dH</span> <span class="o">*</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">inv_efunc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">]])</span>

<span class="c"># Plot the distribution of LRGs, converting redshifts to positions</span>
<span class="c"># assuming Hubble flow.</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s">&#39;RA&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>  <span class="c"># radians</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

<span class="c"># Make the area of each circle representing an LRG position</span>
<span class="c"># proportional to its apparent r-band luminosity.</span>
<span class="n">sizes</span> <span class="o">=</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="p">((</span><span class="n">r</span><span class="p">[</span><span class="s">&#39;rmag&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s">&#39;rmag&#39;</span><span class="p">]))</span><span class="o">/</span> <span class="mf">2.5</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="c"># Plot the LRGs, colouring points by r-i colour.</span>
<span class="n">col</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">sizes</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">r</span><span class="p">[</span><span class="s">&#39;rmi&#39;</span><span class="p">],</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
                  <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Spectral_r</span><span class="p">)</span>

<span class="c"># Add a colourbar.</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
<span class="n">cax</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s">&#39;r-i&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Comoving Mpc&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Comoving Mpc&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This produces the image:</p>
<a class="reference internal image-reference" href="../_images/dist_Mpc.png"><img alt="../_images/dist_Mpc.png" src="../_images/dist_Mpc.png" style="width: 487.2px; height: 367.2px;" /></a>
<p>Now we&#8217;ll plot a histogram of the redshift distribution. This
example demonstrates plotting two scales on the same axis &#8211; redshift
along the bottom of the plot, corresponding distance along the top:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">zbins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">zbins</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;LRG redshift&#39;</span><span class="p">)</span>

<span class="c"># Make a second axis to plot the comoving distance</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">twiny</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

<span class="c"># Generate redshifts corresponding to distance tick positions;</span>
<span class="c"># first get a curve giving Mpc as a function of redshift</span>
<span class="n">redshifts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">dist</span> <span class="o">=</span> <span class="p">[</span><span class="n">dH</span> <span class="o">*</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">inv_efunc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">redshifts</span><span class="p">]</span>
<span class="n">Mpcvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4000</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>

<span class="c"># Then interpolate to the redshift values at which we want ticks.</span>
<span class="n">Mpcticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">Mpcvals</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">redshifts</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">Mpcticks</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">Mpcvals</span><span class="p">])</span>

<span class="c"># Make both axes have the same start and end point.</span>
<span class="n">x0</span><span class="p">,</span><span class="n">x1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Comoving distance (Mpc)&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/hist_z.png"><img alt="../_images/hist_z.png" src="../_images/hist_z.png" style="width: 367.2px; height: 367.2px;" /></a>
</div>
<div class="section" id="making-a-fancy-plot-from-monte-carlo-samples">
<h2>Making a fancy plot from Monte-Carlo samples<a class="headerlink" href="#making-a-fancy-plot-from-monte-carlo-samples" title="Permalink to this headline">¶</a></h2>
<p>Assume you have run an MCMC and you are left with two arrays X,Y of MCMC samples of two fit parameters. You now want to use X,Y to visualise the likelihood manifold. You can do that (a) as a simple scatter plot or (b) in a more fancy way.</p>
<p>Instead of Monte-Carlo samples, you could also be faced with distributions of any two parameters, such as effective temperature and surface gravity of a set of stars, or redshift and magnitude of a set of galaxies.</p>
<p>First, let us create some artificial toy data to mimick the output of an MCMC algorithm in some science application:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span><span class="o">,</span><span class="nn">math</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="kn">as</span> <span class="nn">gridspec</span>

<span class="c"># Create artificial data mimicking some MCMC results.</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">50000</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>  <span class="c"># Draw N samples from normal distribution</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>   <span class="c"># Draw N samples from Gamma distribution</span>
</pre></div>
</div>
<p>Second, let us create a simple plot by plainly plotting x vs. y. This is very easy and we can recap some of the basic Python plotting commands:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Define plot ranges at beginning, since used often later.</span>
<span class="n">YRANGE</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">11.4</span><span class="p">]</span>
<span class="n">XRANGE</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">6.4</span><span class="p">,</span><span class="mf">6.4</span><span class="p">]</span>

<span class="c"># Define figure size and formatting</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.09</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.98</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.98</span><span class="p">)</span>

<span class="c"># Simply plot X vs. Y as data points.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">)</span>

<span class="c"># Set plot ranges, axes ticks and axes labels.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">XRANGE</span><span class="p">)</span>                 <span class="c"># Set x plot range.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">YRANGE</span><span class="p">)</span>                 <span class="c"># Set y plot range.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>          <span class="c"># Set ticks x axis.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>          <span class="c"># Set ticks y axis.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">r&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>  <span class="c"># Set label x axis.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">r&#39;$y$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>  <span class="c"># Set label y axis.</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;plot_MCMC_samples_plain.png&#39;</span><span class="p">)</span> <span class="c"># Save png file.</span>
</pre></div>
</div>
<p>The result looks like this:</p>
<img alt="../_images/plot_MCMC_samples_plain.png" src="../_images/plot_MCMC_samples_plain.png" style="width: 350px; height: 350px;" />
<p>Now, we would like to make this plot a little fancier. Our wish list is:</p>
<ul class="simple">
<li>We would like to see the density in the crowded regions!</li>
<li>smoothed distribution instead of single points</li>
<li>contours of confidence levels</li>
<li>projected distributions of both parameters as side panels</li>
</ul>
<p>The result should look like this:</p>
<img alt="../_images/plot_MCMC_samples_fancy.png" src="../_images/plot_MCMC_samples_fancy.png" style="width: 350px; height: 350px;" />
<p>Here is the code showing how to do this. We start by the top right panel, which is the main panel:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.095</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.975</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.98</span><span class="p">)</span>
<span class="c"># gridspec enables you to assign different formats to panels in one plot.</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c"># Main panel top right contains full 2D histogram.</span>
<span class="c"># Convert to 2d histogram.</span>
<span class="n">Bins</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">hist2D</span><span class="p">,</span> <span class="n">xedges</span><span class="p">,</span> <span class="n">yedges</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="n">Bins</span><span class="p">,</span><span class="n">Bins</span><span class="p">],</span> <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">XRANGE</span><span class="p">,</span><span class="n">YRANGE</span><span class="p">],</span>
    <span class="n">normed</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="c"># Plot Monte-Carlo samples as 2D histogram.</span>
<span class="n">hist2D</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">hist2D</span><span class="p">)</span>  <span class="c"># Beware: numpy switches axes, so switch back.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xedges</span><span class="p">,</span> <span class="n">yedges</span><span class="p">,</span> <span class="n">hist2D</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>

<span class="c"># Overplot with error contours 1,2,3 sigma.</span>
<span class="n">maximum</span>    <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">hist2D</span><span class="p">)</span>
<span class="p">[</span><span class="n">L1</span><span class="p">,</span><span class="n">L2</span><span class="p">,</span><span class="n">L3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="o">*</span><span class="n">maximum</span><span class="p">,</span><span class="mf">0.25</span><span class="o">*</span><span class="n">maximum</span><span class="p">,</span><span class="mf">0.125</span><span class="o">*</span><span class="n">maximum</span><span class="p">]</span>  <span class="c"># Replace with a proper code!</span>
<span class="c"># Use bin edges to restore extent.</span>
<span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="n">xedges</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xedges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">yedges</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">yedges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
<span class="n">cs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">hist2D</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="n">L1</span><span class="p">,</span><span class="n">L2</span><span class="p">,</span><span class="n">L3</span><span class="p">],</span> <span class="n">linestyles</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="s">&#39;--&#39;</span><span class="p">],</span>
    <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;orange&#39;</span><span class="p">,</span><span class="s">&#39;orange&#39;</span><span class="p">,</span><span class="s">&#39;orange&#39;</span><span class="p">],</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c"># use dictionary in order to assign your own labels to the contours.</span>
<span class="n">fmtdict</span> <span class="o">=</span> <span class="p">{</span><span class="n">L1</span><span class="p">:</span><span class="s">r&#39;$1\sigma$&#39;</span><span class="p">,</span><span class="n">L2</span><span class="p">:</span><span class="s">r&#39;$2\sigma$&#39;</span><span class="p">,</span><span class="n">L3</span><span class="p">:</span><span class="s">r&#39;$3\sigma$&#39;</span><span class="p">}</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmtdict</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">XRANGE</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">YRANGE</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, add the two side panels showing the projected distributions of X and Y:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Bin X,Y separately. As 1D bin, can use more bins now.</span>
<span class="n">S</span>  <span class="o">=</span> <span class="mi">101</span>
<span class="n">LX</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">S</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="n">XRANGE</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">LY</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">S</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="n">YRANGE</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="c"># Restore positions lost by binning.</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">XRANGE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">XRANGE</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">XRANGE</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">LX</span><span class="p">)))</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">LX</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">YRANGE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">YRANGE</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">YRANGE</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">LY</span><span class="p">)))</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">LY</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c"># bottom right panel: projected density of x.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">LX</span><span class="p">,</span> <span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;black&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">r&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">r&#39;$\cal L$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">XRANGE</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.1</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">LX</span><span class="p">))</span>

<span class="c"># top left panel: projected density of y.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">LY</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;black&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">r&#39;$\cal L$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">r&#39;$y$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.1</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">LY</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">YRANGE</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;plot_MCMC_samples_fancy.png&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="parallel-process-of-fits-images">
<h2>Parallel process of FITS images<a class="headerlink" href="#parallel-process-of-fits-images" title="Permalink to this headline">¶</a></h2>
<p>This example demonstrates the use of the built-in <a class="reference external" href="http://docs.python.org/library/multiprocessing.html">multiprocessing</a> module, specifically
the ability to create process <em>pools</em>. The idea is essentially that given a
function and a list of inputs to the function, the multiprocessing Pool allows
the function to be run over multiple input values in parallel, speeding up the
process if multiple cores are availbale on a machine.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="kn">import</span> <span class="nn">pyfits</span>
<span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">median_filter</span>

<span class="c"># Define a function to run on files. The steps are:</span>
<span class="c"># - read in FITS file</span>
<span class="c"># - convolve the data in the primary HDU</span>
<span class="c"># - write out the result to a new file</span>
<span class="k">def</span> <span class="nf">smooth</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Processing </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">filename</span>
    <span class="n">hdulist</span> <span class="o">=</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">median_filter</span><span class="p">(</span><span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
    <span class="n">hdulist</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;files/&#39;</span><span class="p">,</span> <span class="s">&#39;files_smooth/&#39;</span><span class="p">),</span>
                    <span class="n">clobber</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c"># Search for all FITS files</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">&#39;files/*.fits&#39;</span><span class="p">)</span>

<span class="c"># Remove output directory if it already exists</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;files_smooth&#39;</span><span class="p">):</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s">&#39;files_smooth&#39;</span><span class="p">)</span>

<span class="c"># Create output directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s">&#39;files_smooth&#39;</span><span class="p">)</span>

<span class="c"># Define a &#39;pool&#39; of 12 processes</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="c"># Run the function over all files in parallel</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">smooth</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span>
</pre></div>
</div>
<p>If we run this from ipython or with python, we can see 12 <tt class="docutils literal"><span class="pre">Processing</span> <span class="pre">...</span></tt> messages appear at the same time, and a quick look at <tt class="docutils literal"><span class="pre">top</span></tt> shows us that 12 processes are running simultaneously. If we run this from <tt class="docutils literal"><span class="pre">ipython</span></tt>, we can then try running it with different number of processes and timing it:</p>
<div class="highlight-python"><pre>In [2]: run process.py

In [3]: p = multiprocessing.Pool(processes=12)

In [4]: %time result = p.map(smooth, files)
Processing files/image_000.fits
...
CPU times: user 0.01 s, sys: 0.00 s, total: 0.02 s
Wall time: 8.45 s

In [52]: p = multiprocessing.Pool(processes=1)

In [53]: %time result = p.map(smooth, files)
Processing files/image_000.fits
...
CPU times: user 0.13 s, sys: 0.04 s, total: 0.17 s
Wall time: 91.78 s</pre>
</div>
<p>The speedup is therefore a factor of 10.9!</p>
</div>
<div class="section" id="more-examples">
<h2>More Examples<a class="headerlink" href="#more-examples" title="Permalink to this headline">¶</a></h2>
<p>The above examples were shown during the keynote session. More can be
found in the <a class="reference internal" href="examples.html#examples"><em>More Examples</em></a> section.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="who-python.html" title="Who is using Python"
             >next</a> |</li>
        <li class="right" >
          <a href="why-python.html" title="Why use Python?"
             >previous</a> |</li>
        <li><a href="../index.html"> 0.1.0 documentation</a> &raquo;</li>
          <li><a href="intro.html" >Introduction and Motivation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright .
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>